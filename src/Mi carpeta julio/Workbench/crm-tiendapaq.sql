-- MySQL Script generated by MySQL Workbench
-- 03/31/15 11:53:45
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema crm-tiendapaq
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema crm-tiendapaq
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `crm-tiendapaq` DEFAULT CHARACTER SET utf8 ;
USE `crm-tiendapaq` ;

-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`actividades_pendiente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`actividades_pendiente` (
  `id_actividad` INT(11) NOT NULL AUTO_INCREMENT,
  `actividad` VARCHAR(40) NOT NULL,
  PRIMARY KEY (`id_actividad`))
ENGINE = InnoDB
AUTO_INCREMENT = 5
DEFAULT CHARACTER SET = utf8
COMMENT = 'Los tipos de pendientes que puede haber en el sisitema';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`bancos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`bancos` (
  `id_banco` INT(3) NOT NULL AUTO_INCREMENT,
  `banco` VARCHAR(30) NOT NULL,
  `sucursal` INT(8) NOT NULL,
  `cta` INT(8) NOT NULL,
  `titular` VARCHAR(50) NOT NULL,
  `cib` VARCHAR(18) NOT NULL,
  PRIMARY KEY (`id_banco`))
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8
COMMENT = 'Datos de las cuentas de banco de la empresa';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`oficinas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`oficinas` (
  `id_oficina` INT(3) NOT NULL AUTO_INCREMENT,
  `ciudad_estado` VARCHAR(70) NOT NULL,
  `ciudad` VARCHAR(40) NOT NULL,
  `estado` VARCHAR(30) NOT NULL,
  `colonia` VARCHAR(30) NOT NULL,
  `calle` VARCHAR(50) NOT NULL,
  `numero` VARCHAR(5) NOT NULL,
  `email` VARCHAR(50) NOT NULL,
  `telefono` VARCHAR(14) NOT NULL,
  PRIMARY KEY (`ciudad_estado`),
  UNIQUE INDEX `id_oficina` (`id_oficina` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = utf8
COMMENT = 'Oficinas registradas en la empresa';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`departamento`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`departamento` (
  `id_departamento` INT(3) NOT NULL AUTO_INCREMENT,
  `area` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`id_departamento`),
  UNIQUE INDEX `area` (`area` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 5
DEFAULT CHARACTER SET = utf8
COMMENT = 'Nombre de los departamentos dentro de la oficina';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`privilegios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`privilegios` (
  `privilegios` VARCHAR(30) NOT NULL,
  UNIQUE INDEX `privilegios` (`privilegios` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COMMENT = 'Privilegios en el sistema';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`ejecutivos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`ejecutivos` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `primer_nombre` VARCHAR(20) NOT NULL,
  `segundo_nombre` VARCHAR(20) NOT NULL,
  `apellido_paterno` VARCHAR(20) NOT NULL,
  `apellido_materno` VARCHAR(20) NOT NULL,
  `oficina` VARCHAR(80) NOT NULL,
  `usuario` VARCHAR(20) NOT NULL,
  `password` VARCHAR(20) NOT NULL,
  `email` VARCHAR(60) NOT NULL,
  `telefono` VARCHAR(14) NOT NULL,
  `departamento` VARCHAR(30) NOT NULL,
  `privilegios` VARCHAR(30) NOT NULL,
  `mensaje_personal` TEXT NOT NULL,
  `asignador_casos` VARCHAR(3) NULL DEFAULT 'no',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `usuario` (`usuario` ASC),
  INDEX `ejecutivos_ibfk_1` (`oficina` ASC),
  INDEX `ejecutivos_ibfk_2` (`departamento` ASC),
  INDEX `ejecutivos_ibfk_3` (`privilegios` ASC),
  CONSTRAINT `ejecutivos_ibfk_1`
    FOREIGN KEY (`oficina`)
    REFERENCES `crm-tiendapaq`.`oficinas` (`ciudad_estado`)
    ON UPDATE CASCADE,
  CONSTRAINT `ejecutivos_ibfk_2`
    FOREIGN KEY (`departamento`)
    REFERENCES `crm-tiendapaq`.`departamento` (`area`)
    ON UPDATE CASCADE,
  CONSTRAINT `ejecutivos_ibfk_3`
    FOREIGN KEY (`privilegios`)
    REFERENCES `crm-tiendapaq`.`privilegios` (`privilegios`)
    ON UPDATE CASCADE)
ENGINE = InnoDB
AUTO_INCREMENT = 12
DEFAULT CHARACTER SET = utf8
COMMENT = 'Registro de ejecutivos en la empresa';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`estatus_general`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`estatus_general` (
  `id_estatus` INT(11) NOT NULL AUTO_INCREMENT,
  `descripcion` VARCHAR(40) NOT NULL,
  PRIMARY KEY (`id_estatus`))
ENGINE = InnoDB
AUTO_INCREMENT = 9
DEFAULT CHARACTER SET = utf8
COMMENT = 'Estatus para los pendientes, casos y tareas';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`clientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`clientes` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `codigo` VARCHAR(10) NOT NULL,
  `razon_social` VARCHAR(80) NOT NULL,
  `rfc` VARCHAR(13) NOT NULL,
  `email` VARCHAR(50) NOT NULL,
  `tipo` VARCHAR(15) NOT NULL,
  `calle` VARCHAR(50) NOT NULL,
  `no_exterior` VARCHAR(5) NOT NULL,
  `no_interior` VARCHAR(5) NOT NULL,
  `colonia` VARCHAR(20) NOT NULL,
  `codigo_postal` VARCHAR(6) NOT NULL,
  `ciudad` VARCHAR(50) NOT NULL,
  `municipio` VARCHAR(50) NOT NULL,
  `estado` VARCHAR(30) NOT NULL,
  `pais` VARCHAR(30) NOT NULL,
  `telefono1` VARCHAR(14) NOT NULL,
  `telefono2` VARCHAR(14) NOT NULL,
  `activo` TINYINT(1) NOT NULL DEFAULT '1',
  `usuario` VARCHAR(10) NOT NULL,
  `password` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `codigo` (`codigo` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 1354
DEFAULT CHARACTER SET = utf8
COMMENT = 'Datos de los clientes';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`estatus_cotizacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`estatus_cotizacion` (
  `id_estatus` INT(11) NOT NULL AUTO_INCREMENT,
  `descripcion` VARCHAR(30) NOT NULL,
  PRIMARY KEY (`id_estatus`))
ENGINE = InnoDB
AUTO_INCREMENT = 8
DEFAULT CHARACTER SET = utf8
COMMENT = 'Estatus para las cotizaciones';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`observaciones`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`observaciones` (
  `id_observacion` INT(3) NOT NULL AUTO_INCREMENT,
  `descripcion` TEXT NOT NULL,
  PRIMARY KEY (`id_observacion`))
ENGINE = InnoDB
AUTO_INCREMENT = 7
DEFAULT CHARACTER SET = utf8
COMMENT = 'Observaciones generales para la cotización';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`contactos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`contactos` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_cliente` INT(11) NOT NULL,
  `nombre_contacto` VARCHAR(30) NOT NULL,
  `apellido_paterno` VARCHAR(20) NOT NULL,
  `apellido_materno` VARCHAR(20) NOT NULL,
  `email_contacto` VARCHAR(50) NOT NULL,
  `telefono_contacto` VARCHAR(14) NOT NULL,
  `puesto_contacto` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `contactos_ibfk_1` (`id_cliente` ASC),
  CONSTRAINT `contactos_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8
COMMENT = 'Información de los contactos del cliente';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`cotizacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`cotizacion` (
  `folio` INT(11) NOT NULL AUTO_INCREMENT,
  `fecha` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `vigencia` TIMESTAMP NOT NULL DEFAULT 0000-00-00 00:00:00,
  `id_ejecutivo` INT(11) NOT NULL,
  `id_cliente` INT(11) NOT NULL,
  `id_contacto` INT(11) NOT NULL,
  `id_oficina` INT(11) NOT NULL,
  `cotizacion` TEXT NOT NULL,
  `id_observaciones` INT(11) NOT NULL,
  `id_banco` INT(11) NOT NULL,
  `id_estatus_cotizacion` INT(11) NOT NULL,
  `total_comentarios` INT(11) NOT NULL,
  `visto` TINYINT(1) NOT NULL DEFAULT '1',
  PRIMARY KEY (`folio`),
  INDEX `cotizacion_ibfk_1` (`id_ejecutivo` ASC),
  INDEX `cotizacion_ibfk_2` (`id_cliente` ASC),
  INDEX `cotizacion_ibfk_3` (`id_oficina` ASC),
  INDEX `cotizacion_ibfk_4` (`id_estatus_cotizacion` ASC),
  INDEX `cotizacion_ibfk_5` (`id_observaciones` ASC),
  INDEX `cotizacion_ibfk_6` (`id_banco` ASC),
  INDEX `id_contacto` (`id_contacto` ASC),
  CONSTRAINT `cotizacion_ibfk_1`
    FOREIGN KEY (`id_ejecutivo`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`)
    ON UPDATE CASCADE,
  CONSTRAINT `cotizacion_ibfk_2`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `cotizacion_ibfk_3`
    FOREIGN KEY (`id_oficina`)
    REFERENCES `crm-tiendapaq`.`oficinas` (`id_oficina`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `cotizacion_ibfk_4`
    FOREIGN KEY (`id_estatus_cotizacion`)
    REFERENCES `crm-tiendapaq`.`estatus_cotizacion` (`id_estatus`)
    ON UPDATE CASCADE,
  CONSTRAINT `cotizacion_ibfk_5`
    FOREIGN KEY (`id_observaciones`)
    REFERENCES `crm-tiendapaq`.`observaciones` (`id_observacion`),
  CONSTRAINT `cotizacion_ibfk_6`
    FOREIGN KEY (`id_banco`)
    REFERENCES `crm-tiendapaq`.`bancos` (`id_banco`),
  CONSTRAINT `cotizacion_ibfk_7`
    FOREIGN KEY (`id_contacto`)
    REFERENCES `crm-tiendapaq`.`contactos` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 4
DEFAULT CHARACTER SET = utf8
COMMENT = 'Registro de las cotizaciones';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`caso`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`caso` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_lider` INT(11) NULL DEFAULT NULL,
  `id_estatus_general` INT(11) NOT NULL,
  `id_cliente` INT(11) NOT NULL,
  `folio_cotizacion` INT(11) NULL DEFAULT NULL,
  `fecha_inicio` DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
  `fecha_final` DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
  `descripcion` TEXT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `id_lider` (`id_lider` ASC, `id_estatus_general` ASC, `id_cliente` ASC, `folio_cotizacion` ASC),
  INDEX `id_estatus_general` (`id_estatus_general` ASC),
  INDEX `id_cliente` (`id_cliente` ASC),
  INDEX `id_cotizacion` (`folio_cotizacion` ASC),
  CONSTRAINT `caso_ibfk_1`
    FOREIGN KEY (`id_lider`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`),
  CONSTRAINT `caso_ibfk_2`
    FOREIGN KEY (`id_estatus_general`)
    REFERENCES `crm-tiendapaq`.`estatus_general` (`id_estatus`),
  CONSTRAINT `caso_ibfk_3`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`),
  CONSTRAINT `caso_ibfk_4`
    FOREIGN KEY (`folio_cotizacion`)
    REFERENCES `crm-tiendapaq`.`cotizacion` (`folio`))
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`comentarios_cotizacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`comentarios_cotizacion` (
  `id_comentario` INT(11) NOT NULL AUTO_INCREMENT,
  `folio` INT(11) NOT NULL,
  `fecha` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `tipo` ENUM('E','C') NOT NULL,
  `id_ejecutivo` INT(11) NULL DEFAULT NULL,
  `comentario` TEXT NOT NULL,
  `visto` TINYINT(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id_comentario`),
  INDEX `folio` (`folio` ASC),
  INDEX `folio_2` (`folio` ASC),
  INDEX `id_ejecutivo` (`id_ejecutivo` ASC),
  INDEX `id_ejecutivo_2` (`id_ejecutivo` ASC),
  CONSTRAINT `comentarios_cotizacion_ibfk_1`
    FOREIGN KEY (`folio`)
    REFERENCES `crm-tiendapaq`.`cotizacion` (`folio`),
  CONSTRAINT `comentarios_cotizacion_ibfk_2`
    FOREIGN KEY (`id_ejecutivo`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 3
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`equipos_computo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`equipos_computo` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_cliente` INT(11) NOT NULL,
  `nombre_equipo` VARCHAR(20) NOT NULL,
  `sistema_operativo` VARCHAR(25) NOT NULL,
  `arquitectura` VARCHAR(10) NOT NULL,
  `maquina_virtual` VARCHAR(2) NOT NULL,
  `memoria_ram` VARCHAR(3) NOT NULL,
  `sql_server` VARCHAR(50) NOT NULL,
  `sql_management` VARCHAR(50) NOT NULL,
  `instancia_sql` VARCHAR(50) NOT NULL,
  `password_sql` VARCHAR(50) NOT NULL,
  `observaciones` TEXT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `equipos_computo_ibfk_1` (`id_cliente` ASC),
  CONSTRAINT `equipos_computo_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COMMENT = 'Iinformacion de los equipos de computo del cliente';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`pendientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`pendientes` (
  `id_pendiente` INT(11) NOT NULL AUTO_INCREMENT,
  `id_creador` INT(11) NOT NULL,
  `id_ejecutivo` INT(11) NOT NULL,
  `id_cliente` INT(11) NULL DEFAULT NULL,
  `id_actividad_pendiente` INT(11) NOT NULL,
  `id_estatus_general` INT(11) NOT NULL,
  `descripcion` TEXT NOT NULL,
  `fecha_origen` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
  `fecha_finaliza` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id_pendiente`),
  INDEX `pendientes_ibfk_1` (`id_creador` ASC),
  INDEX `pendientes_ibfk_2` (`id_ejecutivo` ASC),
  INDEX `pendientes_ibfk_3` (`id_cliente` ASC),
  INDEX `pendientes_ibfk_4` (`id_actividad_pendiente` ASC),
  INDEX `pendientes_ibfk_5` (`id_estatus_general` ASC),
  CONSTRAINT `pendientes_ibfk_1`
    FOREIGN KEY (`id_creador`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`),
  CONSTRAINT `pendientes_ibfk_2`
    FOREIGN KEY (`id_ejecutivo`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`),
  CONSTRAINT `pendientes_ibfk_3`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`),
  CONSTRAINT `pendientes_ibfk_4`
    FOREIGN KEY (`id_actividad_pendiente`)
    REFERENCES `crm-tiendapaq`.`actividades_pendiente` (`id_actividad`),
  CONSTRAINT `pendientes_ibfk_5`
    FOREIGN KEY (`id_estatus_general`)
    REFERENCES `crm-tiendapaq`.`estatus_general` (`id_estatus`))
ENGINE = InnoDB
AUTO_INCREMENT = 3
DEFAULT CHARACTER SET = utf8
COMMENT = 'Registro de pendientes generales en la empresa';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`productos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`productos` (
  `codigo` VARCHAR(20) NOT NULL,
  `descripcion` VARCHAR(100) NOT NULL,
  `unidad` VARCHAR(30) NOT NULL DEFAULT 'Pieza',
  `precio` FLOAT NOT NULL,
  `impuesto1` FLOAT NOT NULL,
  `impuesto2` FLOAT NOT NULL,
  `retencion1` FLOAT NOT NULL,
  `retencion2` FLOAT NOT NULL,
  PRIMARY KEY (`codigo`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COMMENT = 'Registro de productos';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`reasignacion_pendiente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`reasignacion_pendiente` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_pendiente` INT(11) NOT NULL,
  `id_ejecutivo_origen` INT(11) NOT NULL,
  `id_ejecutivo_destino` INT(11) NOT NULL,
  `fecha` TIMESTAMP NOT NULL DEFAULT '0000-00-00 00:00:00',
  `motivo` TEXT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `reasignacion_pendiente_ibfk_1` (`id_pendiente` ASC),
  INDEX `reasignacion_pendiente_ibfk_2` (`id_ejecutivo_origen` ASC),
  INDEX `reasignacion_pendiente_ibfk_3` (`id_ejecutivo_destino` ASC),
  CONSTRAINT `reasignacion_pendiente_ibfk_1`
    FOREIGN KEY (`id_pendiente`)
    REFERENCES `crm-tiendapaq`.`pendientes` (`id_pendiente`),
  CONSTRAINT `reasignacion_pendiente_ibfk_2`
    FOREIGN KEY (`id_ejecutivo_origen`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`),
  CONSTRAINT `reasignacion_pendiente_ibfk_3`
    FOREIGN KEY (`id_ejecutivo_destino`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COMMENT = 'Guarda historial de reasignaciones';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`sistemas_clientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`sistemas_clientes` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_cliente` INT(11) NOT NULL,
  `sistema` VARCHAR(50) NOT NULL,
  `version` VARCHAR(10) NOT NULL,
  `no_serie` VARCHAR(30) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `sistemas_clientes_ibfk_1` (`id_cliente` ASC),
  CONSTRAINT `sistemas_clientes_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`clientes` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COMMENT = 'Informacion de los sistemas de contpaq del cliente';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`sistemas_contpaqi`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`sistemas_contpaqi` (
  `id_sistema` INT(11) NOT NULL AUTO_INCREMENT,
  `sistema` VARCHAR(30) NOT NULL,
  `versiones` TEXT NOT NULL,
  PRIMARY KEY (`id_sistema`))
ENGINE = InnoDB
AUTO_INCREMENT = 12
DEFAULT CHARACTER SET = utf8
COMMENT = 'registro de los sistemas de contpaqi';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`sistemas_operativos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`sistemas_operativos` (
  `id_so` INT(2) NOT NULL AUTO_INCREMENT,
  `sistema_operativo` VARCHAR(30) NOT NULL,
  PRIMARY KEY (`id_so`))
ENGINE = InnoDB
AUTO_INCREMENT = 9
DEFAULT CHARACTER SET = utf8
COMMENT = 'Resgistro de los sistemas operativos';


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`eventos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`eventos` (
  `id_evento` INT NOT NULL AUTO_INCREMENT,
  `id_ejecutivo` INT NOT NULL,
  `titulo` VARCHAR(100) NOT NULL,
  `descripcion` TEXT NOT NULL,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_limite` DATETIME NOT NULL,
  `costo` FLOAT UNSIGNED NOT NULL,
  `max_participantes` INT NOT NULL,
  `modalidad` ENUM('online','sucursal','otro') NOT NULL,
  `link` VARCHAR(45) NOT NULL,
  `total_participantes` INT NOT NULL DEFAULT 0,
  `direccion` TEXT NULL,
  PRIMARY KEY (`id_evento`),
  INDEX `fk_ejecutivo_idx` (`id_ejecutivo` ASC),
  CONSTRAINT `fk_ejecutivo`
    FOREIGN KEY (`id_ejecutivo`)
    REFERENCES `crm-tiendapaq`.`ejecutivos` (`id`)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`sesiones`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`sesiones` (
  `id_sesiones` INT NOT NULL AUTO_INCREMENT,
  `id_evento` INT NOT NULL,
  `fecha` DATETIME NOT NULL,
  `duracion` TINYINT(2) NOT NULL,
  PRIMARY KEY (`id_sesiones`),
  INDEX `id_evento_idx` (`id_evento` ASC),
  CONSTRAINT `id_de_eventos`
    FOREIGN KEY (`id_evento`)
    REFERENCES `crm-tiendapaq`.`eventos` (`id_evento`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `crm-tiendapaq`.`participantes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `crm-tiendapaq`.`participantes` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_evento` INT NOT NULL,
  `id_contacto` INT NOT NULL,
  `id_cliente` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `id_de_contacto_idx` (`id_contacto` ASC),
  INDEX `id_de_cliente_idx` (`id_cliente` ASC),
  INDEX `id_de_evento` (`id_evento` ASC),
  CONSTRAINT `id_de_cliente`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `crm-tiendapaq`.`contactos` (`id_cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_de_contacto`
    FOREIGN KEY (`id_contacto`)
    REFERENCES `crm-tiendapaq`.`contactos` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_de_evento`
    FOREIGN KEY (`id_evento`)
    REFERENCES `crm-tiendapaq`.`eventos` (`id_evento`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

USE `crm-tiendapaq`;

DELIMITER $$
USE `crm-tiendapaq`$$
CREATE
DEFINER=`root`@`localhost`
TRIGGER `crm-tiendapaq`.`participantes_AI_trigger`
AFTER INSERT ON `crm-tiendapaq`.`participantes`
FOR EACH ROW
begin
update eventos set total_participantes = total_participantes + 1
where `participantes`.`id_evento`=`eventos`.`id_evento`;
end$$


DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
